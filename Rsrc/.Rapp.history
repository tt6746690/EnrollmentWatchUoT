ls
a = c(1,2,3)
a
setwd("~/github/waitlist/Rsrc")
setwd("~/github/waitlist/Rsrc")
ls
getwd()
setwd("~/github/waitlist/Rsrc")
setwd("~/github/EnrollmentWatchUofT/Rsrc")
source('main.R')
dt <- data.table(d_201701)
# Load data#
d_201701_p <- "../resources/data"#
d_201701 <- read.table(#
    d_201701_p,#
    header=TRUE#
  )#
dt <- data.table(d_201701)
dt
dt <- dt[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(MAT|STA)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ]
dt
dt <- dt[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(MAT|STA)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, time),#
        ]#
#
print(dt)
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=code)) + geom_line()
ggplot(data = dt, aes(x=time, y=waitlist, group=name, colour=code)) + geom_line()
dt <- dt[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(MAT)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=code)) + geom_line()
dt <- dt[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(MAT)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=code)) + geom_line()
dt <- dt[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(MAT)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=code)) + geom_line()#
ggplot(data = dt, aes(x=time, y=waitlist, group=name, colour=code)) + geom_line()
# Load data#
d_201701_p <- "../resources/data"#
d_201701 <- read.table(#
    d_201701_p,#
    header=TRUE#
  )#
dt <- data.table(d_201701)#
#
# Processing#
#
dt <- dt[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(MAT)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, time),#
        ]
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=code)) + geom_line()
print(dt)
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=substr(name, 3, 4))) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=substr(name, 4, 4))) + geom_line()
# Load data#
d_201701_p <- "../resources/data"#
d_201701 <- read.table(#
    d_201701_p,#
    header=TRUE#
  )#
dt <- data.table(d_201701)#
#
# Processing#
#
dt <- dt[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(MAT)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=floor(capacity / 100))) + geom_line()
d_201701_p <- "../resources/data"#
d_201701 <- read.table(#
    d_201701_p,#
    header=TRUE#
  )#
dt <- data.table(d_201701)#
#
# Processing#
#
dt <- dt[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(MAT)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=floor(capacity / 100))) + geom_line()
# Load data#
d_201701_p <- "../resources/data"#
d_201701 <- read.table(#
    d_201701_p,#
    header=TRUE#
  )#
dt_in <- data.table(d_201701)#
#
# Processing#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(CSC)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=floor(capacity / 100))) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=floor(capacity / 50))) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=floor(capacity / 200))) + geom_line()
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(CHM)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=floor(capacity / 200))) + geom_line()
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(BIO)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=floor(capacity / 200))) + geom_line()
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(MGY)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=floor(capacity / 200))) + geom_line()
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(STA)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour=floor(capacity / 200))) + geom_line()
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(STA)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              demand = actualEnrolment * actualWaitlist / (enrollmentCapacity^2),#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, name, enroll, waitlist, demand, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= demand )) + geom_line()
ggplot(data = dt, aes(x=time, y=waitlist, group=name, colour=demand)) + geom_line()
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl("^(STA)", courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              sec = substr(courseCode, nchar(courseCode) - 3, nchar(courseCode)),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              demand = actualEnrolment * actualWaitlist / (enrollmentCapacity^2),#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, sec, name, enroll, waitlist, demand, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= demand )) + geom_line()
pattern = "^(STA)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              sec = sub(pattern, "", courseCode),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              demand = actualEnrolment * actualWaitlist / (enrollmentCapacity^2),#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(code, sec, name, enroll, waitlist, demand, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= demand )) + geom_line()
pattern = "^(STA)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              demand = actualEnrolment * actualWaitlist / (enrollmentCapacity^2),#
              capacity = enrollmentCapacity,#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01"))#
            ),#
        ][#
          , .(courseCode, code, name, enroll, waitlist, demand, capacity, time),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= courseCode )) + geom_line()
pattern = "^(STA)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              demand = actualEnrolment * actualWaitlist / (enrollmentCapacity^2),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
              year = substr(courseCode, 3, 6)#
            ),#
        ][#
          , .(courseCode, code, name, enroll, waitlist, demand, time, year),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= courseCode )) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=year, colour= courseCode )) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=year)) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=year, colour= courseCode )) + geom_line()
pattern = "^(STA)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              demand = actualEnrolment * actualWaitlist / (enrollmentCapacity^2),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
              year = substr(courseCode, 4, 4)#
            ),#
        ][#
          , .(courseCode, code, name, enroll, waitlist, demand, time, year),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=year, colour= courseCode )) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= year )) + geom_line()
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              enroll = actualEnrolment/enrollmentCapacity,#
              waitlist = actualWaitlist/enrollmentCapacity,#
              demand = actualEnrolment * actualWaitlist / (enrollmentCapacity^2),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
              year = substr(courseCode, 4, 4)#
            ),#
        ][#
          , .(courseCode, code, name, enroll, waitlist, demand, time, year),#
        ]#
#
print(dt)#
#
# Plotting#
#
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= year )) + geom_line()
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              days_from_start = difftime(time,                   # continuous#
                as.Date("2017-01-18"),#
                units = c("days"))#
            ),#
        ][#
          , .(code, name, time, year, enroll, waitlist, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
        ][#
          , .(code, name, time, year, enroll, waitlist),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity     # continuous#
        ][#
          , .(code, name, time, year, enroll, waitlist),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity     # continuous#
          ,#
        ][#
          , .(code, name, time, year, enroll, waitlist),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity     # continuous#
          ),#
        ][#
          , .(code, name, time, year, enroll, waitlist),#
        ]#
#
print(dt)
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,     # continuous#
              days_from_start = difftime(time,                   # continuous#
                as.Date("2017-01-18"),#
                units = c("days"))#
              )#
          ),#
        ][#
          , .(code, name, time, year, enroll, waitlist),#
        ]#
#
print(dt)
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,     # continuous#
              days_from_start = difftime(time,                   # continuous#
                as.Date("2017-01-18"),#
                units = c("days"))#
          ),#
        ][#
          , .(code, name, time, year, enroll, waitlist),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,     # continuous#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(time,                   # continuous#
                as.Date("2017-01-18"),#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, year, enroll, waitlist),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity     # continuous#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(time,                   # continuous#
                as.Date("2017-01-18"),#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, year, enroll, waitlist, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity     # continuous#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(#
                as.Date("2017-01-18"),                   # continuous#
                time,#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, year, enroll, waitlist, days_from_start),#
        ]#
#
print(dt)
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity     # continuous#
          ),#
        ][#
          , ':=' (#
              days_from_start = -difftime(#
                time,                   # continuous#
                as.Date("2017-01-18"),#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, year, enroll, waitlist, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity     # continuous#
          ),#
        ][#
          , ':=' (#
              days_from_start = -difftime(#
                time,                   # continuous#
                as.Date("2016-12-23"),#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, year, enroll, waitlist, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              year = substr(courseCode, 4, 4),                   # ordinal#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity     # continuous#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(#
                time,                   # continuous#
                as.Date("2016-12-23"),  # start date#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, year, enroll, waitlist, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity                      # continuous#
              year = substr(courseCode, 4, 4),                   # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, days_from_start),#
        ]#
#
print(dt)#
# multiple regression#
#
fit <- lm(enroll ~ enroll + waitlist + capacity, data=dt)#
summary(fit)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, days_from_start),#
        ]#
#
print(dt)#
# multiple regression#
#
fit <- lm(enroll ~ enroll + waitlist + capacity, data=dt)#
summary(fit)
layout(matrix(c(1,2,3,4),2,2)) # optional 4 graphs/page#
plot(fit)
fit <- lm(enroll ~ enroll + waitlist + capacity + factor(year), data=dt)#
summary(fit)
fit <- lm(enroll ~ waitlist + capacity + factor(year), data=dt)
summary(fit)
fit <- lm(enroll ~ enroll + waitlist + capacity + factor(year), data=dt)#
summary(fit)
fit <- lm(enroll ~ waitlist + capacity + factor(year), data=dt)
fit <- lm(enroll ~ waitlist + capacity + factor(year), data=dt)#
summary(fit)
fit <- lm(enroll ~ waitlist + capacity + factor(year) + factor(days_from_start), data=dt)#
summary(fit)
fit <- lm(enroll ~ factor(days_from_start), data=dt)#
summary(fit)
fit <- lm(enroll ~ days_from_start, data=dt)#
summary(fit)
fit <- lm(enroll ~ factor(year), data=dt)#
summary(fit)
fit <- lm(enroll ~ capacity, data=dt)#
summary(fit)
fit <- lm(enroll ~ capacity + factor(year), data=dt)#
summary(fit)
fit <- lm(enroll ~ factor(year), data=dt)#
summary(fit)
fit <- lm(enroll ~ capacity, data=dt)#
summary(fit)
fit <- lm(enroll ~ factor(year), data=dt)#
summary(fit)
fit <- lm(enroll ~ capacity + factor(year), data=dt)#
summary(fit)
fit <- lm(waitlist ~ capacity + factor(year), data=dt)#
summary(fit)
fit <- lm(waitlit ~ enroll + capacity + factor(year), data=dt)#
summary(fit)
fit <- lm(enroll ~ waitlist + capacity + factor(year), data=dt)#
summary(fit)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          waitlist >= 0.05#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          waitlist >= 0.05,,#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          mean(waitlist) >= 0.01,,#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, days_from_start),#
        ]#
#
print(dt)
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          mean(waitlist) >= 0.05,,#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          mean(waitlist) >= 0.05,,#
          by=name#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days"))#
            )#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)
summary(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ][,.N,by=waitlist_by_name_bar]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          waitlist_by_name_bar > 0,,       # intersted in active waitlist only#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= year )) + geom_line()
# Processing#
#
pattern = "^(CSC)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          waitlist_by_name_bar > 0,,       # intersted in active waitlist only#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= year )) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= waitlist_by_name_bar )) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= capacity )) + geom_line()
pattern = "^(MAT)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          waitlist_by_name_bar > 0,,       # intersted in active waitlist only#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= capacity )) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= year )) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= waitlist )) + geom_line()
ggplot(data = dt, aes(x=time, y=waitlist, group=name, colour=year)) + geom_line()
pattern = "^(MAT|CSC)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          waitlist_by_name_bar > 0,,       # intersted in active waitlist only#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= waitlist )) + geom_line()
ggplot(data = dt, aes(x=time, y=waitlist, group=name, colour=year)) + geom_line()
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= year )) + geom_line()
fit <- lm(enroll ~ waitlist + capacity + factor(year) + factor(days_from_start), data=dt)
summary(fit)
fit <- lm(enroll ~ waitlist + capacity + factor(year) + days_from_start, data=dt)
summary(fit)
fit <- lm(waitlist ~ enroll + capacity + factor(year) + days_from_start, data=dt)#
summary(fit)
pattern = "^(CSC)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          waitlist_by_name_bar > 0,,       # intersted in active waitlist only#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)#
# multiple regression#
fit <- lm(enroll ~ waitlist + capacity + factor(year) + days_from_start, data=dt)#
summary(fit)
fit <- lm(enroll ~ days_from_start, data=dt)#
summary(fit)
fit <- lm(enroll ~ factor(days_from_start), data=dt)#
summary(fit)
fit <- lm(enroll ~ factor(year) +factor(days_from_start), data=dt)#
summary(fit)#
fit <- lm(enroll ~ factor(year) +factor(days_from_start), data=dt)
fit <- lm(enroll ~ capacity + factor(year) +factor(days_from_start), data=dt)#
summary(fit)
fit <- lm(enroll ~ capacity + factor(year) + days_from_start, data=dt)#
summary(fit)
pattern = "^()"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          waitlist_by_name_bar > 0,,       # intersted in active waitlist only#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)#
# multiple regression#
# waitlist + capacity + factor(year) +#
fit <- lm(enroll ~ capacity + factor(year) + days_from_start, data=dt)#
summary(fit)
ggplot(data = dt, aes(x=time, y=enroll, group=name, colour= year )) + geom_line()
pattern = "^(CSC)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          waitlist_by_name_bar > 0,,       # intersted in active waitlist only#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)#
# multiple regression#
# waitlist + capacity + factor(year) +#
fit <- glm(waitlist ~ capacity + factor(year) + days_from_start, data=dt)#
summary(fit)
install.packages("ResourceSelection")
install.packages("ResourceSelection")
library(data.table)#
library(ggplot2)#
library(ResourceSelection)#
#
setwd("~/github/EnrollmentWatchUofT/Rsrc")#
#
# Load data#
d_201701_p <- "../resources/data"#
d_201701 <- read.table(#
    d_201701_p,#
    header=TRUE#
  )#
dt_in <- data.table(d_201701)#
#
# Processing#
#
pattern = "^(CSC)"#
#
dt <- dt_in[section == "S" & teachingMethod == "LEC" &#
         waitlist == "Y" & enrollmentCapacity != "9999" &#
         grepl(pattern, courseCode) &#
         epochTime <= as.POSIXct( as.Date("2017-01-18") ),  # last day to add/change courses#
        ][#
          , ':=' (#
              code = substr(courseCode, 0, 3),#
              name = paste(courseCode, sectionNumber, sep='_'),#
              time = as.Date(as.POSIXct(epochTime, origin="1970-01-01")),#
#
              # independent variables as estimators#
              enroll = actualEnrolment/enrollmentCapacity,       # continuous#
              waitlist = actualWaitlist/enrollmentCapacity,      # continuous#
              capacity = enrollmentCapacity,                     # continuous#
              year = substr(courseCode, 4, 4)                    # ordinal#
          ),#
        ][#
          , ':=' (#
              days_from_start = difftime(                        # ordinal#
                time,#
                as.Date("2016-12-23"),  # start date#
                units = c("days")),#
              waitlist_by_name_bar = mean(waitlist)#
            ),#
            by=name#
        ][#
          waitlist_by_name_bar > 0,,       # intersted in active waitlist only#
        ][#
          , .(code, name, time, enroll, waitlist, capacity, year, waitlist_by_name_bar, days_from_start),#
        ]#
#
print(dt)#
# multiple regression#
# waitlist + capacity + factor(year) +#
model <- glm(waitlist ~ capacity + factor(year) + days_from_start, data=dt)#
summary(model)#
hoslem.test(dt$waitlist, fitted(model))
model <- lm(waitlist ~ capacity + factor(year) + days_from_start, data=dt)#
summary(model)
model <- lm(waitlist ~ capacity + factor(year) + factor(days_from_start), data=dt)#
summary(model)
model <- lm(waitlist ~ capacity + factor(year) + days_from_start, data=dt)#
summary(model)
model <- lm(waitlist ~ capacity + year + days_from_start, data=dt)#
summary(model)
model <- lm(waitlist ~ (capacity/200) + (year/4) + (days_from_start/27), data=dt)#
summary(model)
par(mfrow=c(2,2))#
termplot(lmMultiple)
par(mfrow=c(2,2))#
termplot(model)
plot(dt$waitlist, fitted(model))
model <- lm(waitlist ~ capacity + year + days_from_start, data=dt)#
summary(model)#
#
plot(dt$waitlist, fitted(model))
plot(dt$waitlist, fitted(model), xlim = c(0, 1), ylim = c(0, 1))
